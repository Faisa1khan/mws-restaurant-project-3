let restaurant;var map,bool_favouriteImage;window.initMap=(()=>{if(self.restaurant)return loadMap();setTimeout(initMap,49)}),window.loadMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)}),fetchRestaurantFromURL=(()=>new Promise((e,t)=>{if(self.restaurant)return e(self.restaurant);const r=getParameterByName("id");if(!r)return error="No restaurant id in URL",t(error);DBHelper.fetchRestaurantById(r,(r,a)=>{if(self.restaurant=a,!a)return console.error(r),t(r);DBHelper.getReviews(self.restaurant.id).then(t=>(self.restaurant.reviews=t,e(self.restaurant))).catch(e=>t(e))})})),submitReviewForm=(()=>{for(var e={},t=document.getElementById("add-review-form"),r=0;r<t.length;++r){var a=t[r].name,n=t[r].value;""!==a&&""!==n&&("restaurant_id"!==a&&"rating"!==a||(n=parseInt(n)),e[t[r].name]=n)}t.reset(),postReview(e)}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img lazyload";var r=DBHelper.imageUrlForRestaurant(e),a=r.length;const n=(r=r.substring(0,a-5))+"-500-small.jpeg",s=r+"-750-medium.jpeg",i=r+".jpeg";t.dataset.src=n,t.dataset.srcset=`${n} 320w, ${s} 503w, ${i} 900w`,t.sizes="(max-width: 503px) 320px, (max-width: 900px) 503px, 900px",t.alt=e.name+" restaurant marketing photograph",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const a=document.createElement("tr"),n=document.createElement("td");n.innerHTML=r,a.appendChild(n);const s=document.createElement("td");s.innerHTML=e[r],a.appendChild(s),t.appendChild(a)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container");if(!e||!e.length){const e=document.createElement("p");return e.setAttribute("tabindex","0"),e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");r.innerHTML="",e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),r=document.createElement("section"),a=document.createElement("span");a.innerHTML=e.name,a.classList.add("reviewer-name"),a.setAttribute("tabindex","0"),r.appendChild(a);const n=document.createElement("span");n.innerHTML=new Date(e.updatedAt).toLocaleDateString(),n.classList.add("date"),n.setAttribute("tabindex","0"),r.appendChild(n),t.appendChild(r);const s=document.createElement("span");s.innerHTML=`Rating: ${e.rating}`,s.classList.add("rating"),s.setAttribute("tabindex","0"),t.appendChild(s);const i=document.createElement("p");return i.innerHTML=e.comments,i.setAttribute("tabindex","0"),t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,r.setAttribute("aria-current","page"),t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}),click_toggleFavourite=(()=>{self.restaurant.is_favorite=!self.bool_favouriteImage,toggle_favouriteimage(self.restaurant.is_favorite);const e="http://localhost:1337/restaurants/"+self.restaurant.id+"/?is_favorite="+self.restaurant.is_favorite;var t=new Headers;t.set("Accept","application/json"),fetch(e,{method:"PUT",headers:t}).then(DBHelper.updateRestaurants)}),toggle_favouriteimage=(e=>{var t=document.getElementById("myFavouriteImage");e?(t.setAttribute("src","img/favourite/favourite.png"),self.bool_favouriteImage=!0):(t.setAttribute("src","img/favourite/unfavourite.png"),self.bool_favouriteImage=!1)}),fetchRestaurantFromURL().then(e=>{DBHelper.getReviews(e.id),document.getElementById("restaurant_id").value=e.id,fillBreadcrumb(),document.getElementById("add-review-form").addEventListener("submit",function(e){e.preventDefault(),submitReviewForm()}),toggle_favouriteimage(e.is_favorite),document.addEventListener("reviews_updated",e=>{console.log("Got reviews updated event",e),console.log("current restaurant",self.restaurant),e.detail.restaurant_id===self.restaurant.id&&(console.log("Updating review list"),DBHelper.getReviews(self.restaurant.id).then(e=>{self.restaurant.reviews=e,fillReviewsHTML(e)}))})}).then(fillRestaurantHTML).catch(e=>{console.error("Init Error: ",e)});